[SERVER]
11.11.11.11

[DOWNLOAD]
CESM/2.1.3 https://github.com/ESCOMP/CESM/archive/refs/tags/release-cesm2.1.3.tar.gz

[DEPENDENCY]
set -x
set -e
./jarvis -install kgcc/9.3.1 com
./jarvis -install bisheng/2.5.0 com
module purge
module use ./software/modulefiles
module load kgcc/9.3.1
./jarvis -install kml/1.6.0/gcc gcc
module load bisheng/2.5.0
export CC=`which clang`
export CXX=`which clang++`
export FC=`which flang`
./jarvis -install hmpi/1.2.0 bisheng
module load hmpi/1.2.0
export CC=mpicc CXX=mpicxx FC=mpifort F77=mpifort
./jarvis -install hdf5/1.12.0/clang clang+mpi
module load hdf5-clang/1.12.0
./jarvis -install pnetcdf/1.12.1 clang+mpi
module load pnetcdf/1.12.1
if [ $HDF5_CLANG_PATH ];then
    echo $HDF5_CLANG_PATH
else
    echo "HDF5 is not exists"
    exit 1
fi
./jarvis -install netcdf/4.7.4/clang clang+mpi
#tar -xzvf $JARVIS_DOWNLOAD/release-cesm2.1.3.tar.gz

[ENV]
module purge
module use software/modulefiles
module use software/moduledeps
module load bisheng/2.5.0
module load hmpi/1.2.0
module load hdf5-clang/1.12.0
module load pnetcdf/1.12.1
module load netcdf-clang/4.7.4
module load kml-gcc/1.6.0

[APP]
app_name = CESM
build_dir = $JARVIS_ROOT/CESM-release-cesm2.1.3
binary_dir =
case_dir = $JARVIS_ROOT/CESM-release-cesm2.1.3/cime/scripts

[BUILD]
#./manage_externals/checkout_externals
#./manage_externals/checkout_externals -S
cd cime/scripts
#./create_newcase --case fangesm --compset F2000climo --res f09_f09_mg17
cd fangesm
./check_case
./check_input_data --download
./xmlchange NTASKS=128,NTHRDS=1,ROOTPE=0
./xmlchange STOP_OPTION=nhours,STOP_N=1
./xmlchange DOUT_S=FALSE
#./xmlchange NTASKS_ATM=208,NTASKS_CPL=208,NTASKS_OCN=208,NTASKS_WAV=208,NTASKS_GLC=208,NTASKS_ICE=208,NTASKS_ROF=208,NTASKS_LND=208,NTASKS_ESP=1
./case.setup --reset
./case.build

[CLEAN]
cd cime/scripts/fangesm
#如果修改env_build.xml
./case.build --clean
#如果修改config_machines/config_compilers
#./case.build --clean-all

[RUN]
run = chmod +x run.sh && dsub -s run.sh
binary =
nodes = 1

[BATCH]
#! /bin/bash
